#!/usr/bin/env python

import io
import os

from sqlalchemy import create_engine
from sqlalchemy.schema import MetaData


DATABASE_URL = "sqlite:////tmp/sandbox/development.db"


def run():
    engine = create_engine(DATABASE_URL)
    metadata = MetaData(engine)
    metadata.reflect(bind=engine)

    project_root = os.path.abspath(os.path.join(os.path.dirname(__file__), ".."))
    models_module = os.path.join(project_root, "sandbox", "models.py")

    print("[ bin/db-reflect ]", "Updating database models definition.")

    outfile = io.open(models_module, "w", encoding="utf-8")

    from sqlacodegen.codegen import CodeGenerator
    CodeGenerator(metadata).render(outfile)

    relative_models_path = models_module.replace(project_root, "")[1:]
    print("[ bin/db-reflect ]   ", relative_models_path, "is updated")


if __name__ == "__main__":
    run()
